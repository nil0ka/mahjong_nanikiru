# Mahjong Nanikiru Problem Generator - AI Agent Rules

This repository generates "What to discard" (nanikiru) problems for Mahjong using AI.

## How to Use

When asked to generate problems or solutions, use the Python scripts:

```bash
# Generate a new problem
python scripts/generate_question.py

# Generate a problem with specific number
python scripts/generate_question.py 5

# Generate solution for latest problem
python scripts/generate_solution.py

# Generate solution for specific problem
python scripts/generate_solution.py 5
```

**Example prompts:**
- "ä½œå•ã—ã¦" â†’ Generates next numbered problem
- "å•é¡Œ005ã®è§£ç­”ã‚’ç”Ÿæˆã—ã¦" â†’ Generates solution for problem 005
- "ãƒªãƒ¼ãƒåˆ¤æ–­ã®å•é¡Œã‚’ä½œã£ã¦" â†’ Generates riichi decision problem
- "é›£æ˜“åº¦7ã®æŠ¼ã—å¼•ãå•é¡Œã‚’ä½œã£ã¦" â†’ Generates difficulty 7 push/fold problem

## Critical: Tile Notation Policy

**MANDATORY: Unicode + Numeric Notation (ä½µè¨˜)**

To prevent misidentification errors, all problems and solutions MUST use **both Unicode and numeric notation**:

```markdown
## ã‚ãªãŸã®æ‰‹ç‰Œï¼ˆ13æšï¼‰
\`\`\`
ğŸ€‡ğŸ€ˆğŸ€™ğŸ€šğŸ€›ğŸ€œğŸ€”ğŸ€•ğŸ€–ğŸ€ƒğŸ€ƒğŸ€ƒğŸ€…
(1m2m1p2p3p4p5s6s7såŒ—åŒ—åŒ—ç™¼)
\`\`\`

## ãƒ„ãƒ¢ç‰Œ
\`\`\`
ğŸ€
(5p)
\`\`\`
```

**Why this format:**
- Unicode tiles provide visual representation
- Numeric notation prevents misidentification
- Combining both maximizes readability and accuracy

### Unicode Mahjong Tiles Reference

**CRITICAL**: Always refer to this table when reading or writing tiles:

**è¬å­ (Manzu)**: ğŸ€‡=1m ğŸ€ˆ=2m ğŸ€‰=3m ğŸ€Š=4m ğŸ€‹=5m ğŸ€Œ=6m ğŸ€=7m ğŸ€=8m ğŸ€=9m

**ç­’å­ (Pinzu)**: ğŸ€™=1p ğŸ€š=2p ğŸ€›=3p ğŸ€œ=4p ğŸ€=5p ğŸ€=6p ğŸ€Ÿ=7p ğŸ€ =8p ğŸ€¡=9p

**ç´¢å­ (Souzu)**: ğŸ€=1s ğŸ€‘=2s ğŸ€’=3s ğŸ€“=4s ğŸ€”=5s ğŸ€•=6s ğŸ€–=7s ğŸ€—=8s ğŸ€˜=9s

**å­—ç‰Œ (Honors)**: ğŸ€€=æ± ğŸ€=å— ğŸ€‚=è¥¿ ğŸ€ƒ=åŒ— ğŸ€†=ç™½ ğŸ€…=ç™¼ ğŸ€„=ä¸­

## Mahjong Problem Format

Problems must include:

1. **Difficulty level**: 10-point scale (â˜…â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜†â˜† 1/10 to â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… 10/10)
   - 1-2: Very Easy (obvious answer, no calculation)
   - 3-4: Easy (clear answer with basic analysis)
   - 5-6: Medium (requires multiple factor analysis)
   - 7-8: Hard (complex analysis, multiple viable candidates)
   - 9-10: Very Hard (expert-level, subtle differences)

2. **Theme**: Problem category (e.g., ãƒªãƒ¼ãƒåˆ¤æ–­, æ‰‹ç‰Œé¸æŠ, æŠ¼ã—å¼•ã, å¾…ã¡é¸æŠ, å½¢å¼ãƒ†ãƒ³ãƒ‘ã‚¤, é³´ãåˆ¤æ–­, å®‰å…¨ç‰Œé¸æŠ)

3. **Game state**: Round, seat wind, dora indicator, turn number

4. **Hand tiles**: Exactly 14 tiles (13 in hand + 1 drawn tile)
   - **CRITICAL**: Must specify the drawn tile (ãƒ„ãƒ¢ç‰Œ) separately
   - Format: 13-tile hand + 1 tsumo tile

5. **Discards (æ²³)**: Discard piles for all four players

## Critical: Shanten Calculation

**Internal analysis process:**
1. Read Unicode tiles using reference table (one by one)
2. **Convert to numeric notation** (e.g., ğŸ€”ğŸ€•ğŸ€– â†’ `5s6s7s`)
3. Analyze hand structure using numeric notation
4. Verify sequences numerically (5-6-7 is continuous, NOT 4-5-6)

**Calculate shanten for ALL winning patterns:**
- Standard (4 mentsu + 1 jantou)
- Chiitoitsu (ä¸ƒå¯¾å­)
- Kokushi musou (å›½å£«ç„¡åŒ)
- Take the minimum shanten

**Verify problem accuracy:**
- 14-tile hand (13 + tsumo) shanten matches problem description
- Test ALL useful tiles to verify claims (e.g., "drawing 4p makes it tenpai")
- Never trust problem description blindly - always verify independently

## Scoring and Yaku (å½¹)

### Common Yaku

**1 han:**
- Riichi (ç«‹ç›´): Closed only
- Tanyao (æ–­ä¹ˆä¹): No terminals/honors
- Pinfu (å¹³å’Œ): All sequences, two-sided wait, non-value pair (closed only)
- Yakuhai (å½¹ç‰Œ): Honor triplet (winds, dragons)

**2 han:**
- Chiitoitsu (ä¸ƒå¯¾å­): Seven pairs (always 25 fu, closed only)
- Sanshoku doujun (ä¸‰è‰²åŒé †): Same sequence in all 3 suits (1 han if open)
- Toitoi (å¯¾ã€…å’Œ): All triplets

**3 han:**
- Honitsu (æ··ä¸€è‰²): One suit + honors (2 han if open)
- Junchan (ç´”å…¨å¸¯ä¹ˆä¹): All sets contain terminals (2 han if open)

**6 han:**
- Chinitsu (æ¸…ä¸€è‰²): One suit only (5 han if open)

**Dora**: +1 han per dora tile

### Point Calculation

**Child (å­) ron scores:**
- 1 han 30 fu: 1000
- 2 han 30 fu: 2000
- 3 han 30 fu: 3900
- 4 han 30 fu: 7700
- 5+ han: 8000+ (Mangan or above)

**Chiitoitsu (always 25 fu):**
- 2 han: 1600
- 3 han: 3200
- 4 han: 6400

## Push/Fold (æŠ¼ã—å¼•ã) Analysis

**Three strategies (NOT just attack/fold binary):**

**1. Waiting strategy (æ§˜å­è¦‹) - DEFAULT for most situations:**
- Discard relatively safe tiles while keeping hand progression possible
- Maintains flexibility to shift to attack if hand improves
- **NOT complete fold** - still has winning possibility
- Use when: genbutsu available, hand is iishanten with useful tiles, not critical ranking situation

**2. Complete fold (ãƒ™ã‚¿é™ã‚Š) - ONLY for extreme situations:**
- Discard only genbutsu for multiple consecutive turns
- Explicitly abandon all winning possibility
- Use when: Oorasu + critical ranking + 3+ shanten + multiple genbutsu available

**3. Full attack (å…¨åŠ›ã§æ”»ã‚ã‚‹) - ONLY when winning is critical:**
- Discard tiles that progress hand even if dangerous
- Use when: Oorasu + must win to improve ranking + good hand with high value

**Analysis methodology:**

a. **Analyze YOUR hand's potential:**
   - List all ideal forms with specific yaku and point values
   - Use qualitative likelihood: "extremely low", "low", "moderate", "high"
   - Avoid fabricated percentages without clear basis

b. **Analyze OPPONENT's hand from river:**
   - Dora visibility: If not visible, opponent likely has dora
   - Yakuhai visibility: Check which honors are visible/missing
   - List possible patterns with point ranges
   - Conclusion: "Since dora not visible, 3 han (3900-5800) or higher likely"

c. **Compare risk vs reward:**
   - Use qualitative comparison
   - Consider ranking impact
   - Default to waiting strategy for most situations

## Genbutsu (ç¾ç‰©) - Absolute Safe Tiles

**Genbutsu**: A tile that riichi declarer has already discarded = **100% safe (absolute safety)**

- Look at riichi player's discard pile (æ²³)
- Any tile visible in their discards is genbutsu
- Never say "relatively safe" when it's genbutsu - it's ABSOLUTELY safe (0% risk)

## Wait Selection (Tenpai Problems)

**CRITICAL: Always check for multiple wait options**

**4-tile sequences (å››é€£å½¢) - Nobetan:**
- 1234 â†’ wait 1 or 4 (nobetan)
- 2345 â†’ wait 2 or 5 (nobetan)
- 6789 â†’ wait 6 or 9 (nobetan)
- Example: Discard 1p vs 3p creates different waits (nobetan vs tanki)

**Complex 7-tile multi-way waits:**
- Pattern: 3+ identical tiles + consecutive numbers + pair
- Example: 4445688s = 3-way wait (4s, 7s, 8s)
- Always test ALL possible interpretations

**Validation checklist:**
- [ ] Did I check for 4-tile sequences?
- [ ] Did I consider nobetan wait?
- [ ] Did I check for ankou + consecutive + pair patterns?
- [ ] Did I calculate tile acceptance for each wait?
- [ ] Did I compare waits explicitly?

## Point Distribution Validation

**æ±1å±€0æœ¬å ´**: All players MUST have exactly 25000 points (starting points)
- No exceptions - this is the first hand
- DO NOT use æ±1å±€0æœ¬å ´ for push/fold problems (point situations are critical)

**æ±1å±€1æœ¬å ´**: Only possible if dealer won or dealer tenpai draw
- Dealer's points should have increased or small transfers only
- NOT possible if dealer's points decreased significantly

**Always verify:**
- Sum of all four players' points = 100000
- Dealer position matches round (æ±1å±€ = æ±å®¶ is dealer)
- æœ¬å ´ count matches point distribution story

## File Structure

- `problems/NNN/question.md` - Problems (001, 002, ..., 1000+)
- `problems/NNN/solution.md` - Solutions
- `scripts/generate_question.py` - Problem generation script
- `scripts/generate_solution.py` - Solution generation script

Numbers are zero-padded to 3 digits (001-999), unlimited digits supported (1000+).

## Validation Requirements

When generating solutions, ALWAYS verify:

1. **Accurate tile identification** - Use Unicode reference table
2. **Independent shanten calculation** - Don't trust problem description blindly
3. **Accurate tile counting** - Count visible tiles, calculate remaining
4. **Identify genbutsu correctly** - Check riichi player's river
5. **Validate recommended discard** - Tile must be in actual hand
6. **Point distribution consistency** - Sum = 100000, matches round/honba
7. **Wait selection** - Check for nobetan and multi-way waits
8. **Push/fold analysis** - List ideal forms, analyze river, use qualitative comparison

For detailed specifications, see CLAUDE.md.
